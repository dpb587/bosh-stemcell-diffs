#!/bin/bash

set -e

export STEMCELL_INFRASTRUCTURE=$1
export STEMCELL_HYPERVISOR=$2
export STEMCELL_OS_NAME=$3
export STEMCELL_OS_VERSION=$4
export STEMCELL_VERSION_PREV=$5
export STEMCELL_VERSION_NEXT=$6

METADATA_DIR_PREV="stemcells/metadata/$STEMCELL_VERSION_PREV/$STEMCELL_INFRASTRUCTURE/$STEMCELL_HYPERVISOR/$STEMCELL_OS_NAME-$STEMCELL_OS_VERSION"
METADATA_DIR_NEXT="stemcells/metadata/$STEMCELL_VERSION_NEXT/$STEMCELL_INFRASTRUCTURE/$STEMCELL_HYPERVISOR/$STEMCELL_OS_NAME-$STEMCELL_OS_VERSION"

echo "Comparing $STEMCELL_VERSION_PREV to $STEMCELL_VERSION_NEXT"
echo ""

for metadata in bin/metadata-* ; do
  metadata_name=$( echo "$metadata" | cut -c14- )

  echo "====> $metadata_name"
  diff "$METADATA_DIR_PREV/$metadata_name" "$METADATA_DIR_NEXT/$metadata_name" || true
  echo ""
done
